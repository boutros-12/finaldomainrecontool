<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Domain Reconnaissance Tool</title>
<style>
  body { font-family: Arial; max-width: 900px; margin: 40px auto; padding: 0 20px; }
  input, button { font-size: 16px; }
  input { width: 65%; padding: 10px; }
  button { padding: 11px 18px; cursor: pointer; margin-left: 8px; }
  pre { background: #f4f4f4; padding: 12px; white-space: pre-wrap; border: 1px solid #ccc; }
  .error { color: red; margin-top: 10px; }
  .loading { font-style: italic; margin-top: 10px; color: #555; display: none; }
  h3 { margin-top: 40px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
  .copy-btn { font-size: 12px; padding: 3px 6px; background: #eee; border: none; cursor: pointer; }
  @media(max-width: 600px) { input { width: 100%; margin-bottom: 8px; } button { width: 100%; margin-top: 5px; } }
</style>
</head>
<body>

<h1>Domain Reconnaissance Tool</h1>

<h3>Domain Lookup</h3>
<small>Gets DNS, SPF, DKIM, DMARC, and other records</small><br/>
<input id="domainInput" placeholder="example.com" onkeypress="if(event.key==='Enter') runRecon()" />
<button onclick="runRecon()">Run Recon</button>
<div id="loading" class="loading">Loading...</div>
<div id="output"></div>
<div id="error" class="error"></div>
<hr/>

<h3>IP Lookup (IPinfo)</h3>
<small>Shows location, ASN, and timezone info for an IP</small><br/>
<input id="ipinfoInput" placeholder="8.8.8.8" onkeypress="if(event.key==='Enter') runIpinfo()" />
<button onclick="runIpinfo()">Lookup IPinfo</button>
<div id="loadingIpinfo" class="loading">Loading...</div>
<div id="outputIpinfo"></div>
<div id="errorIpinfo" class="error"></div>
<hr/>

<h3>IP Reputation (AbuseIPDB)</h3>
<small>Checks malicious activity reports for an IP</small><br/>
<input id="abuseIpInput" placeholder="8.8.8.8" onkeypress="if(event.key==='Enter') runAbuseIPDB()" />
<button onclick="runAbuseIPDB()">Check Abuse</button>
<div id="loadingAbuse" class="loading">Loading...</div>
<div id="outputAbuse"></div>
<div id="errorAbuse" class="error"></div>
<hr/>

<h3>Subdomain Enumeration (Subfinder)</h3>
<small>Finds related subdomains known on the internet</small><br/>
<input id="subfinderDomainInput" placeholder="example.com" onkeypress="if(event.key==='Enter') runSubfinder()" />
<button onclick="runSubfinder()">Find Subdomains</button>
<div id="loadingSubfinder" class="loading">Scanning...</div>
<div id="outputSubfinder"></div>
<div id="errorSubfinder" class="error"></div>

<script>
function validateDomain(name) {
  return /^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(name);
}

function validateIPv4(ip) {
  return /^(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}$/.test(ip);
}

function copyOutput(id) {
  const text = document.getElementById(id).innerText;
  navigator.clipboard.writeText(text);
  alert("Copied to clipboard!");
}

async function runRecon() {
  const val = domainInput.value.trim();
  output.innerHTML = ''; error.textContent = '';
  if (!validateDomain(val)) return error.textContent = 'Invalid domain';
  loading.style.display = 'block';
  try {
    const r = await fetch(`/api/recon?domain=${encodeURIComponent(val)}`);
    loading.style.display = 'none';
    const data = await r.json();
    if (data.error) return error.textContent = data.error;
    output.innerHTML = `<button class="copy-btn" onclick="copyOutput('output')">Copy</button><pre>${JSON.stringify(data, null, 2)}</pre>`;
  } catch (e) { loading.style.display = 'none'; error.textContent = e.message; }
}

async function runIpinfo() {
  const ip = ipinfoInput.value.trim();
  outputIpinfo.innerHTML = ''; errorIpinfo.textContent = '';
  if (!validateIPv4(ip)) return errorIpinfo.textContent = 'Invalid IPv4';
  loadingIpinfo.style.display = 'block';
  try {
    const r = await fetch(`/api/ipinfo_ip?ip=${encodeURIComponent(ip)}`);
    loadingIpinfo.style.display = 'none';
    const data = await r.json();
    if (data.error) return errorIpinfo.textContent = data.error;
    outputIpinfo.innerHTML = `<button class="copy-btn" onclick="copyOutput('outputIpinfo')">Copy</button><pre>${JSON.stringify(data, null, 2)}</pre>`;
  } catch (e) { loadingIpinfo.style.display = 'none'; errorIpinfo.textContent = e.message; }
}

async function runAbuseIPDB() {
  const ip = abuseIpInput.value.trim();
  outputAbuse.innerHTML = ''; errorAbuse.textContent = '';
  if (!validateIPv4(ip)) return errorAbuse.textContent = 'Invalid IPv4';
  loadingAbuse.style.display = 'block';
  try {
    const r = await fetch(`/api/abuseipdb_ip?ip=${encodeURIComponent(ip)}`);
    loadingAbuse.style.display = 'none';
    const data = await r.json();
    if (data.error) return errorAbuse.textContent = data.error;
    outputAbuse.innerHTML = `<button class="copy-btn" onclick="copyOutput('outputAbuse')">Copy</button><pre>${JSON.stringify(data, null, 2)}</pre>`;
  } catch (e) { loadingAbuse.style.display = 'none'; errorAbuse.textContent = e.message; }
}

async function runSubfinder() {
  const dom = subfinderDomainInput.value.trim();
  outputSubfinder.innerHTML = ''; errorSubfinder.textContent = '';
  if (!validateDomain(dom)) return errorSubfinder.textContent = 'Invalid domain';
  loadingSubfinder.style.display = 'block';
  try {
    const r = await fetch(`/api/subdomain_scan?domain=${encodeURIComponent(dom)}`);
    loadingSubfinder.style.display = 'none';
    const data = await r.json();
    if (data.error) return errorSubfinder.textContent = data.error;
    outputSubfinder.innerHTML = `<button class="copy-btn" onclick="copyOutput('outputSubfinder')">Copy</button><pre>${JSON.stringify(data, null, 2)}</pre>`;
  } catch (e) { loadingSubfinder.style.display = 'none'; errorSubfinder.textContent = e.message; }
}
</script>
</body>
</html>
