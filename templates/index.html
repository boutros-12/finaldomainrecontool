<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Domain Recon Tool</title>
<style>
body{font-family:Arial,sans-serif;max-width:900px;margin:auto;padding:20px;}
h1{text-align:center;}
h3{margin-top:30px;border-bottom:1px solid #ccc;padding-bottom:5px;}
input,button{font-size:16px;padding:10px;}
input{width:65%;}
button{background:#007BFF;color:white;border:none;cursor:pointer;}
.error{color:red;margin-top:5px;}
.loading{display:none;color:#555;}
.output-box{background:#f8f8f8;border:1px solid #ccc;padding:10px;margin-top:10px;white-space:pre-wrap;word-break:break-word;max-height:400px;overflow-y:auto;}
</style>
</head>
<body>

<h1>Domain Reconnaissance Tool</h1>

<h3>Domain Lookup</h3>
<input id="domainInput" placeholder="example.com" onkeypress="if(event.key==='Enter') runRecon()"/>
<button onclick="runRecon()">Check SPF / DKIM / DMARC / IPs</button>
<div id="loading" class="loading">Loading...</div>
<div id="error" class="error"></div>
<div id="output"></div>

<hr/>

<h3>IP Reputation (AbuseIPDB)</h3>
<input id="abuseIpInput" placeholder="8.8.8.8" onkeypress="if(event.key==='Enter') runAbuseIPDB()"/>
<button onclick="runAbuseIPDB()">Check Abuse</button>
<div id="loadingAbuse" class="loading">Loading...</div>
<div id="errorAbuse" class="error"></div>
<div id="outputAbuse"></div>

<hr/>

<h3>Subdomain Enumeration (Subfinder)</h3>
<input id="subfinderDomainInput" placeholder="example.com" onkeypress="if(event.key==='Enter') runSubfinder()"/>
<button onclick="runSubfinder()">Find Subdomains</button>
<div id="loadingSubfinder" class="loading">Scanning...</div>
<div id="errorSubfinder" class="error"></div>
<div id="outputSubfinder"></div>

<hr/>

<h3>IP Lookup (Shodan)</h3>
<input id="shodanIpInput" placeholder="8.8.8.8" onkeypress="if(event.key==='Enter') runShodanIp()"/>
<button onclick="runShodanIp()">Lookup Shodan</button>
<div id="loadingShodan" class="loading">Loading...</div>
<div id="errorShodan" class="error"></div>
<div id="outputShodan"></div>

<script>
function validateDomain(n){return /^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(n);}
function validateIP(ip){return /^(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))){3}$/.test(ip);}

async function runRecon(){
  error.textContent=''; output.innerHTML=''; loading.style.display='block';
  const domain=domainInput.value.trim();
  if(!validateDomain(domain)){loading.style.display='none'; return error.textContent='Invalid domain';}
  const resp=await fetch(`/api/recon?domain=${domain}`);
  loading.style.display='none';
  const data=await resp.json();
  if(data.error){error.textContent=data.error;return;}
  output.innerHTML=`<div class="output-box">${JSON.stringify(data,null,2)}</div>`;
}

async function runAbuseIPDB(){
  errorAbuse.textContent=''; outputAbuse.innerHTML=''; loadingAbuse.style.display='block';
  const ip=abuseIpInput.value.trim();
  if(!validateIP(ip)){loadingAbuse.style.display='none'; return errorAbuse.textContent='Invalid IPv4';}
  const resp=await fetch(`/api/abuseipdb_ip?ip=${ip}`);
  loadingAbuse.style.display='none';
  const data=await resp.json();
  if(data.error){errorAbuse.textContent=data.error;return;}
  outputAbuse.innerHTML=`<div class="output-box">${JSON.stringify(data,null,2)}</div>`;
}

async function runSubfinder(){
  errorSubfinder.textContent=''; outputSubfinder.innerHTML=''; loadingSubfinder.style.display='block';
  const dom=subfinderDomainInput.value.trim();
  if(!validateDomain(dom)){loadingSubfinder.style.display='none'; return errorSubfinder.textContent='Invalid domain';}
  const resp=await fetch(`/api/subdomain_scan?domain=${dom}`);
  loadingSubfinder.style.display='none';
  const data=await resp.json();
  if(data.error){errorSubfinder.textContent=data.error;return;}
  outputSubfinder.innerHTML=`<div class="output-box">${JSON.stringify(data,null,2)}</div>`;
}

async function runShodanIp(){
  errorShodan.textContent=''; outputShodan.innerHTML=''; loadingShodan.style.display='block';
  const ip=shodanIpInput.value.trim();
  if(!validateIP(ip)){loadingShodan.style.display='none'; return errorShodan.textContent='Invalid IPv4';}
  const resp=await fetch(`/api/shodan_ip?ip=${ip}`);
  loadingShodan.style.display='none';
  const data=await resp.json();
  if(data.error){errorShodan.textContent=data.error;return;}
  outputShodan.innerHTML=`<div class="output-box">${JSON.stringify(data,null,2)}</div>`;
}
</script>

</body>
</html>
