<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Domain Reconnaissance Tool</title>
<style>
body{font-family:Arial,sans-serif;background:#f8f9fa;color:#333;max-width:1000px;margin:auto;padding:20px;}
h1{text-align:center;margin-bottom:10px;}
h3{margin-top:40px;color:#222;border-bottom:2px solid #ddd;padding-bottom:5px;}
small{color:#555;margin-bottom:10px;display:block;}
input,button{font-size:16px;padding:10px;margin-top:5px;}
input{width:65%;border:1px solid #ccc;border-radius:4px;}
button{border:none;border-radius:4px;background:#007BFF;color:white;cursor:pointer;}
button:hover{background:#0056b3;}
.error{color:#b30000;margin-top:8px;}
.loading{color:#666;display:none;}
.output-box{
  background:#fff;
  padding:15px;
  border:1px solid #ccc;
  border-radius:6px;
  margin-top:10px;
  white-space:pre-wrap;
  word-break:break-word;
  max-height:400px;
  overflow-y:auto;
  overflow-x:hidden;
  line-height:1.4;
}
.output-box pre {
  white-space: pre-wrap !important;
  word-break: break-word !important;
  max-width: 100%;
  font-size: 13px;
  line-height: 1.4;
  margin: 7px 0 12px 0;
  padding: 7px 10px;
  background: #f4f6fa;
  border-radius: 4px;
  border:1px solid #eee;
  box-shadow: 0 0 2px #eaeaea;
}
.copy-btn{font-size:12px;padding:4px 8px;background:#eee;border:1px solid #ccc;cursor:pointer;border-radius:4px;margin-bottom:10px;}
/* Vertical score bar badge styling */
.scorebar-wrap{margin-bottom:8px;}
.scorebar-label{display:inline-block;padding:3px 12px;border-radius:12px;font-weight:bold;font-size:13px;margin-right:12px;}
.scorebar-label.high{background:#28a745;color:#fff;}
.scorebar-label.medium{background:#ffc107;color:#333;}
.scorebar-label.low{background:#dc3545;color:#fff;}
.scorebar-outer{display:inline-block;height:18px;width:210px;background:#eee;border-radius:9px;vertical-align:middle;}
.scorebar-inner{height:100%;border-radius:9px;}
.scorebar-inner.high{background:#28a745;}
.scorebar-inner.medium{background:#ffc107;}
.scorebar-inner.low{background:#dc3545;}
/* Clickable IPs */
.resolved-ip-link {
  color: #007BFF;
  text-decoration: underline;
  cursor: pointer;
  margin-right: 8px;
  font-weight: bold;
}
.resolved-ip-link:hover { color: #0056b3;}
</style>
</head>
<body>

<h1>Domain Reconnaissance Tool</h1>

<h3>Domain Lookup</h3>
<small>SPF, DKIM (selector1 & selector2), DMARC, and resolved IPs with scores</small>
<input id="domainInput" placeholder="example.com" onkeypress="if(event.key==='Enter') runRecon()" />
<button onclick="runRecon()">Run Recon</button>
<div id="loading" class="loading">Loading...</div>
<div id="error" class="error"></div>
<div id="output"></div>
<hr/>

<h3>IP Reputation (AbuseIPDB)</h3>
<small>Check IP reputation and abuse reports</small>
<input id="abuseIpInput" placeholder="8.8.8.8" />
<button onclick="runAbuseIPDB()">Check Abuse</button>
<div id="loadingAbuse" class="loading">Loading...</div>
<div id="errorAbuse" class="error"></div>
<div id="outputAbuse"></div>
<hr/>

<h3>Subdomain Enumeration (Subfinder)</h3>
<small>Find known subdomains</small>
<input id="subfinderDomainInput" placeholder="example.com" onkeypress="if(event.key==='Enter') runSubfinder()" />
<button onclick="runSubfinder()">Find Subdomains</button>
<div id="loadingSubfinder" class="loading">Scanning...</div>
<div id="errorSubfinder" class="error"></div>
<div id="outputSubfinder"></div>
<hr/>

<h3>IP Lookup (Shodan)</h3>
<small>Shodan scan data for IP</small>
<input id="shodanIpInput" placeholder="8.8.8.8" />
<button onclick="runShodanIp()">Lookup Shodan</button>
<div id="loadingShodan" class="loading">Loading...</div>
<div id="errorShodan" class="error"></div>
<div id="outputShodan"></div>
<hr/>

<script>
// ----- Score visual helpers -----
function scoreClass(score) {
  if (score >= 80) return 'high';
  if (score >= 50) return 'medium';
  return 'low';
}
function scoreLabel(score) {
  if (score >= 80) return 'Excellent';
  if (score >= 50) return 'Good';
  return 'Poor';
}
function scoreBar(score) {
  const cls = scoreClass(score);
  const label = scoreLabel(score);
  return `<div class="scorebar-wrap">
    <span class="scorebar-label ${cls}">${label} (${score})</span>
    <span class="scorebar-outer">
      <span class="scorebar-inner ${cls}" style="width:${Math.max(0,Math.min(score,100))}%;display:block;"></span>
    </span>
  </div>`;
}

// Clickable resolved IPs helper
function renderResolvedIPs(ipsArr) {
  return ipsArr.map(ip =>
    `<span class="resolved-ip-link" onclick="setIpInputs('${ip}')">${ip}</span>`
  ).join(", ");
}
function setIpInputs(ip) {
  document.getElementById('abuseIpInput').value = ip;
  document.getElementById('errorAbuse').textContent = '';
  document.getElementById('outputAbuse').innerHTML = '';
  document.getElementById('shodanIpInput').value = ip;
  document.getElementById('errorShodan').textContent = '';
  document.getElementById('outputShodan').innerHTML = '';
  document.getElementById('abuseIpInput').scrollIntoView({behavior: 'smooth', block: 'center'});
}

// ==== Domain Recon ====
async function runRecon(){
  error.textContent='';output.innerHTML='';loading.style.display='block';
  const domain=domainInput.value.trim();
  if(!/^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(domain)){loading.style.display='none';return error.textContent='Invalid domain';}
  try{
    const r=await fetch(`/api/recon?domain=${encodeURIComponent(domain)}`);
    loading.style.display='none';const d=await r.json();
    if(d.error)return error.textContent=d.error;
    let spfRec=Array.isArray(d.SPF.records)?d.SPF.records.join("\n"):d.SPF.records;
    let dmarcRec=Array.isArray(d.DMARC.records)?d.DMARC.records.join("\n"):d.DMARC.records;
    let ips=Array.isArray(d.Resolved_IPs)?renderResolvedIPs(d.Resolved_IPs):d.Resolved_IPs;
    let dkimHtml="";
    if(typeof d.DKIM.records==="string"){dkimHtml=`<pre>${d.DKIM.records}</pre>`;}
    else{
      for(const s in d.DKIM.records){
        let score=d.DKIM.scores[s]||0;
        let recs=d.DKIM.records[s].join("\n");
        dkimHtml+=`<b>${s}:</b>${scoreBar(score)}<pre>${recs}</pre>`;
      }
    }
    output.innerHTML=`<button class="copy-btn" onclick="copyOutput('output')">Copy</button>
      <div class="output-box" id="output">
        <b>Resolved IPs:</b> ${ips}<br/><br/>
        <b>SPF:</b>${scoreBar(d.SPF.score)}<pre>${spfRec}</pre>
        <b>DMARC:</b>${scoreBar(d.DMARC.score)}<pre>${dmarcRec}</pre>
        <b>DKIM:</b><br/>${dkimHtml}
      </div>`;
  }catch(e){loading.style.display='none';error.textContent=e;}
}

// ==== AbuseIPDB ====
async function runAbuseIPDB(){
  errorAbuse.textContent='';outputAbuse.innerHTML='';loadingAbuse.style.display='block';
  const ip=abuseIpInput.value.trim();
  if(!/^(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}$/.test(ip)){loadingAbuse.style.display='none';return errorAbuse.textContent='Invalid IPv4';}
  try{
    const r=await fetch(`/api/abuseipdb_ip?ip=${encodeURIComponent(ip)}`);
    loadingAbuse.style.display='none';const d=await r.json();
    if(d.error)return errorAbuse.textContent=d.error;
    outputAbuse.innerHTML=`<button class="copy-btn" onclick="copyOutput('outputAbuse')">Copy</button>
      <div class="output-box" id="outputAbuse"><pre>${JSON.stringify(d,null,2)}</pre></div>`;
  }catch(e){loadingAbuse.style.display='none';errorAbuse.textContent=e;}
}

// ==== Subfinder ====
async function runSubfinder(){
  errorSubfinder.textContent='';outputSubfinder.innerHTML='';loadingSubfinder.style.display='block';
  const dom=subfinderDomainInput.value.trim();
  if(!/^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(dom)){loadingSubfinder.style.display='none';return errorSubfinder.textContent='Invalid domain';}
  try{
    const r=await fetch(`/api/subdomain_scan?domain=${encodeURIComponent(dom)}`);
    loadingSubfinder.style.display='none';const d=await r.json();
    if(d.error)return errorSubfinder.textContent="Error: "+d.error;
    outputSubfinder.innerHTML=`<button class="copy-btn" onclick="copyOutput('outputSubfinder')">Copy</button>
      <div class="output-box" id="outputSubfinder"><pre>${JSON.stringify(d,null,2)}</pre></div>`;
  }catch(e){loadingSubfinder.style.display='none';errorSubfinder.textContent=e;}
}

// ==== Shodan ====
async function runShodanIp(){
  errorShodan.textContent='';outputShodan.innerHTML='';loadingShodan.style.display='block';
  const ip=shodanIpInput.value.trim();
  if(!/^(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}$/.test(ip)){loadingShodan.style.display='none';return errorShodan.textContent='Invalid IPv4';}
  try{
    const r=await fetch(`/api/shodan_ip?ip=${encodeURIComponent(ip)}`);
    loadingShodan.style.display='none';const d=await r.json();
    if(d.error)return errorShodan.textContent=d.error;
    outputShodan.innerHTML=`<button class="copy-btn" onclick="copyOutput('outputShodan')">Copy</button>
      <div class="output-box" id="outputShodan"><pre>${JSON.stringify(d,null,2)}</pre></div>`;
  }catch(e){loadingShodan.style.display='none';errorShodan.textContent=e;}
}
function copyOutput(id){navigator.clipboard.writeText(document.getElementById(id).innerText);alert("Copied!");}
</script>
</body>
</html>
